# hooks addon discover support
# no discover1 support avalaible yet
# works good with discover


if [ $TCOS_DISCOVER ] ;then
    
    # check for tcos-discover2
    tcos_discover=$(dpkg -l tcos-discover2 2>/dev/null | grep -c ^ii)
    
    # check if discover is discover or discover1
    discover1=$(dpkg -l discover1|grep -c ^ii 2>/dev/null)
    
    if [ ${tcos_discover} = 1 ]; then
        stat_before
        disco_path=/usr/lib/tcos/discover
        # Discover
        cpifexists $disco_path/sbin/discover               /usr/bin/
        cpifexists $disco_path/usr/bin/discover-config     /usr/bin
        cpifexists $disco_path/sbin/discover-modprobe      /usr/bin
        cpifexists $disco_path/etc/discover-modprobe.conf  /etc/

        copydir $disco_path/lib/discover /lib/
        cpifexists $disco_path/usr/lib/libdiscover.so.2 /usr/lib/

        mkdir -p $DESTDIR/usr/share/discover/dtd/

        copydir $disco_path/usr/share/discover/dtd/ /usr/share/discover/
        copydir $disco_path/etc/discover.conf.d/    /etc/

        if [ -d $disco_path/etc/discover.d/ ]; then
           copydir $disco_path/etc/discover.d/         /etc/
	    fi

	    mkdir -p $DESTDIR/etc/default
	    cp /etc/default/rcS             ${DESTDIR}/etc/default/

        stat_after "Tcos Discover2"
   
    elif [ ${discover1} = 1 ]; then
        echo "WARNING:"
        echo ""
        echo "discover1 detected, USE discover or tcos-discover2 or disable discover"
        echo "             discover1 is not supported"
        echo "   => apt-get install tcos-discover2"
        echo "   => apt-get install discover"
        echo ""
    
    else
        stat_before
        # Discover
        cpifexists /sbin/discover        /usr/bin/
        cpifexists /usr/bin/discover-config  /usr/bin
        cpifexists /sbin/discover-modprobe   /usr/bin
        cpifexists /etc/discover-modprobe.conf /etc/

        copydir /lib/discover /lib/
        cpifexists /usr/lib/libdiscover.so.2 /usr/lib/

        mkdir -p $DESTDIR/usr/share/discover/dtd/

        copydir /usr/share/discover/dtd/ /usr/share/discover/
        copydir /etc/discover.conf.d/    /etc/

        if [ -d /etc/discover.d/ ]; then
           copydir /etc/discover.d/         /etc/
	    fi

	    mkdir -p $DESTDIR/etc/default
	    cp /etc/default/rcS             ${DESTDIR}/etc/default/

        stat_after "Discover"
  
   fi
   # end of tcos_discover fi

fi
# end of TCOS_DISCOVER
