# hook addon DHCLIENT
# necessary busybox package


# some network stuff
touch $DESTDIR/etc/hosts.allow
touch $DESTDIR/etc/hosts.deny
cpifexists /etc/host.conf        /etc/
#cpifexists /etc/nsswitch.conf    /etc/
sed '/hosts:/ chosts:          files dns' /etc/nsswitch.conf > $DESTDIR/etc/nsswitch.conf

# put DNS server
dns1=$(grep ^nameserver /etc/resolv.conf 2>/dev/null | grep -v "127.0.0.1" | head -1 | awk '{print $2}')
echo "TCOS_DNS_SERVER=${dns1}" >> ${DESTDIR}/conf/tcos.conf

# check for "busybox udhcpc -O 290| grep swapsrv"
# 290 option no exists, busybox return know options
check=$(busybox udhcpc -O 290 2>&1| grep -c swapsrv)
if [ "$check" != "0" ]; then
  cpifexists ${TCOS_BINS}/udhcpc-script  /bin/
elif [ -x /sbin/udhcpc ]; then
  cpifexists /sbin/udhcpc /sbin/
else
 echo "ERROR"
 echo ""
 echo "NO UDHCP support, please install a recent busybox package."
 echo ""
fi


