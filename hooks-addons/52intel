# hook for intel graphics card
# Copyright Rubén Gómez Antolí <listas at mucharuina [.] com>


#rgrep -h 8086 /usr/share/xserver-xorg/pci/ | sed -e 's/8086/8086:/g'
#8086:7800
#8086:7121
#8086:7123
#8086:7125
#8086:1132
#8086:7120
#8086:7122
#8086:7124
#8086:1130
#8086:3577
#8086:3575
#8086:2562
#8086:2560
#8086:3582
#8086:3580
#8086:2572
#8086:2570
#8086:2582
#8086:2580
#8086:2592
#8086:2590
#8086:258A
#8086:2580
#8086:2772
#8086:2770
#8086:27A2
#8086:27A0
#8086:27AE
#8086:27AC
#8086:2982
#8086:2980
#8086:2992
#8086:2990
#8086:29A2
#8086:29A0
#8086:2972
#8086:2970
#8086:2A02
#8086:2A00
#8086:2A12
#8086:2A10
#8086:29C2
#8086:29C0
#8086:29B2
#8086:29B0
#8086:29D2
#8086:29D0
#8086:2A40
#8086:2E00
#8086:2E20
#8086:2E10
#8086:2E32
#8086:2E30
# -e "8086:7800" -e "8086:7121" -e "8086:7123" -e "8086:7125" -e "8086:1132" \
# -e "8086:7120" -e "8086:7122" -e "8086:7124" -e "8086:1130" -e "8086:3577" \
# -e "8086:3575" -e "8086:2562" -e "8086:2560" -e "8086:3582" -e "8086:3580" \
# -e "8086:2572" -e "8086:2570" -e "8086:2582" -e "8086:2580" -e "8086:2592" \
# -e "8086:2590" -e "8086:258A" -e "8086:2580" -e "8086:2772" -e "8086:2770" \
# -e "8086:27A2" -e "8086:27A0" -e "8086:27AE" -e "8086:27AC" -e "8086:2982" \
# -e "8086:2980" -e "8086:2992" -e "8086:2990" -e "8086:29A2" -e "8086:29A0" \
# -e "8086:2972" -e "8086:2970" -e "8086:2A02" -e "8086:2A00" -e "8086:2A12" \
# -e "8086:2A10" -e "8086:29C2" -e "8086:29C0" -e "8086:29B2" -e "8086:29B0" \
# -e "8086:29D2" -e "8086:29D0" -e "8086:2A40" -e "8086:2E00" -e "8086:2E20" \
# -e "8086:2E10" -e "8086:2E32" -e "8086:2E30"
 
cat << EOF > $DESTDIR/sbin/disable_dpms
#!/bin/sh

waitforX
# disable dpms
sleep 2
xset -dpms

EOF
chmod +x $DESTDIR/sbin/disable_dpms


cat << EOF > $DESTDIR/etc/X11/PreRun/30intel_dpms
#!/bin/sh

test1=0
test1=\$(lspci -n | awk '{print toupper(\$3)}' | grep -c -e "8086:7800" -e "8086:7121" \
  -e "8086:7123" -e "8086:7125" -e "8086:1132" \
 -e "8086:7120" -e "8086:7122" -e "8086:7124" -e "8086:1130" -e "8086:3577" \
 -e "8086:3575" -e "8086:2562" -e "8086:2560" -e "8086:3582" -e "8086:3580" \
 -e "8086:2572" -e "8086:2570" -e "8086:2582" -e "8086:2580" -e "8086:2592" \
 -e "8086:2590" -e "8086:258A" -e "8086:2580" -e "8086:2772" -e "8086:2770" \
 -e "8086:27A2" -e "8086:27A0" -e "8086:27AE" -e "8086:27AC" -e "8086:2982" \
 -e "8086:2980" -e "8086:2992" -e "8086:2990" -e "8086:29A2" -e "8086:29A0" \
 -e "8086:2972" -e "8086:2970" -e "8086:2A02" -e "8086:2A00" -e "8086:2A12" \
 -e "8086:2A10" -e "8086:29C2" -e "8086:29C0" -e "8086:29B2" -e "8086:29B0" \
 -e "8086:29D2" -e "8086:29D0" -e "8086:2A40" -e "8086:2E00" -e "8086:2E20" \
 -e "8086:2E10" -e "8086:2E32" -e "8086:2E30")

if [ "\$test1" != "0" ]; then
  /sbin/disable_dpms &
fi


EOF

chmod +x $DESTDIR/etc/X11/PreRun/30intel_dpms


