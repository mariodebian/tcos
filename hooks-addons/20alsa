# hooks addon SOUND support
# need alsa-utils


if [ ! $TCOS_SOUND ]; then
  _verbose "(20alsa) TCOS_SOUND disabled"
else

    stat_before
    
    # TCOS MIXER (include ALSA and OSS support)
    cpifexists ${TCOS_BINS}/tmixer  /usr/bin/
 
    mkdir -p $DESTDIR/usr/share/
    copydir /usr/share/alsa/ /usr/share/

    # Ubuntu make pulse default in this dir (thin clients must use ALSA directly)
    rm -f $DESTDIR/usr/share/alsa/*pulse*

    mkdir -p $DESTDIR/var/run/alsa

    mkdir -p $DESTDIR/lib
    if [ -d /lib/alsa ]; then
     copydir /lib/alsa      /lib/
    fi

    mkdir -p $DESTDIR/etc/init.d/
    cpifexists /etc/init.d/alsa-utils /etc/init.d/
 
    if [ -d /etc/alsa ]; then
      copydir /etc/alsa/      /etc/
    fi

    if [ -f /etc/modutils/alsa-base ]; then
      # OLD alsa-base
      mkdir -p $DESTDIR/etc/modutils/
      cpifexists /etc/modutils/alsa-base /etc/modutils
    fi

    if [ -f /etc/modprobe.d/alsa-base ]; then
      # NEW alsa-base
      mkdir -p $DESTDIR/etc/modprobe.d/
      cpifexists /etc/modprobe.d/alsa-base /etc/modprobe.d/
    fi

    if [ -f /etc/modprobe.d/alsa-base.conf ]; then
      # NEW alsa-base
      mkdir -p $DESTDIR/etc/modprobe.d/
      cpifexists /etc/modprobe.d/alsa-base.conf /etc/modprobe.d/
    fi


    # copy sox if avalaible (needed for RTP)
    if [ "$(_ldd /usr/bin/play >/dev/null 2>&1 ; echo $? )" = "1"  ]; then
      # play is a script (Ubuntu dapper => gutsy and Debian etch)
      cpifexists /usr/bin/play  /usr/bin/
      cpifexists /usr/bin/sox   /usr/bin/
    else
      # play is a binary (or symlink to sox)
      cpifexists /usr/bin/play  /usr/bin/
    fi

    if [ -d /usr/lib/sox ]; then
      mkdir -p ${DESTDIR}/usr/lib/sox/
      for lib in $(find /usr/lib/sox/ -type f| grep -v -e mp3 -e flac -e sd2 -e fap -e vorbis -e mat5 -e wavpack -e ffmpeg -e mat4 -e pvf); do
         cpifexists $lib  /usr/lib/sox/
      done
    fi

    mkdir -p ${DESTDIR}/usr/lib/alsa-lib/
    [ -e /usr/lib/alsa-lib/libasound_module_pcm_pulse.so ] && \
         cpifexists /usr/lib/alsa-lib/libasound_module_pcm_pulse.so    /usr/lib/alsa-lib/
    [ -e /usr/lib/alsa-lib/libasound_module_ctl_pulse.so ]  && \
         cpifexists /usr/lib/alsa-lib/libasound_module_ctl_pulse.so    /usr/lib/alsa-lib/
    # new in Ubuntu??
    [ -e /usr/lib/alsa-lib/libasound_module_conf_pulse.so ] && \
         cpifexists /usr/lib/alsa-lib/libasound_module_conf_pulse.so /usr/lib/alsa-lib/
    [ -e /usr/lib/alsa-lib/libasound_module_pcm_alsa_dsp.so ] && \
         cpifexists /usr/lib/alsa-lib/libasound_module_pcm_alsa_dsp.so /usr/lib/alsa-lib/



 
    stat_after "Alsa sound support"

fi # end of TCOS_SOUND
